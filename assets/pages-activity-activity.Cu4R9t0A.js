import{r as a,c as t,w as e,i as s,o as l,a as i,b as c,n,h as o,j as d,F as u,k as r,d as p,e as m,t as f,K as g,l as _,m as v,q as y,u as b,B as k}from"./index-CuaaJPDA.js";import{_ as h}from"./logo.rRFpfryy.js";import{o as j}from"./uni-app.es.l4NMnEKD.js";import{r as x}from"./request.CEomxEkn.js";import{_ as P}from"./_plugin-vue_export-helper.BCo6x5W8.js";const T=""+new URL("banner2-BQ6U7tAq.jpg",import.meta.url).href,w=P({__name:"activity",setup(P){const w=a("ongoing"),C=a([]);j((()=>{S()}));const $=a=>{w.value=a,S()},S=async()=>{try{const a=await x({url:`/activity/list?filter=${w.value}`});a.data?C.value=a.data.map((a=>q(a))):C.value=[]}catch(a){C.value=[]}},q=a=>{const t=new Date(a.startTime),e=new Date(a.endTime),s=t.getMonth()+1+"æœˆ",l=t.getDate().toString(),i=a=>`${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}`,c=`${i(t)} - ${i(e)}`;let n="",o="";return"ended"===a.status?(n="å·²ç»“æŸ",o="ended"):"upcoming"===a.status?(n="ç«‹å³æŠ¥å",o="upcoming"):(n="ç«‹å³æŠ¥å",o="ongoing"),a.isJoined?n="å·²æŠ¥å":a.joinedPeople>=a.maxPeople&&"ended"!==a.status&&(n="åé¢å·²æ»¡",o="ended"),{...a,month:s,day:l,time:c,statusText:n,statusType:o}},D=a=>!a.isJoined&&"ended"!==a.status&&a.joinedPeople<a.maxPeople;return(a,j)=>{const P=p,q=s,F=m;return l(),t(q,{class:"page"},{default:e((()=>[i(q,{class:"header-banner"},{default:e((()=>[i(P,{src:T,mode:"aspectFill",class:"banner-img"}),i(q,{class:"banner-mask"}),i(q,{class:"banner-text"},{default:e((()=>[i(F,{class:"main-title"},{default:e((()=>[c("çŽ¯ä¿æ´»åŠ¨æ—¥åŽ†")])),_:1}),i(F,{class:"sub-title"},{default:e((()=>[c("å‚ä¸Žæ´»åŠ¨ï¼Œèµ¢å–ç§¯åˆ†ï¼Œå…±å»ºç»¿è‰²æ ¡å›­")])),_:1})])),_:1})])),_:1}),i(q,{class:"tabs"},{default:e((()=>[i(q,{class:n(["tab",{active:"ongoing"===w.value}]),onClick:j[0]||(j[0]=a=>$("ongoing"))},{default:e((()=>[c("è¿›è¡Œä¸­")])),_:1},8,["class"]),i(q,{class:n(["tab",{active:"upcoming"===w.value}]),onClick:j[1]||(j[1]=a=>$("upcoming"))},{default:e((()=>[c("å³å°†å¼€å§‹")])),_:1},8,["class"]),i(q,{class:n(["tab",{active:"ended"===w.value}]),onClick:j[2]||(j[2]=a=>$("ended"))},{default:e((()=>[c("å·²ç»“æŸ")])),_:1},8,["class"])])),_:1}),i(q,{class:"activity-list"},{default:e((()=>[(l(!0),o(u,null,d(C.value,((a,s)=>(l(),t(q,{class:"activity-card",key:s,onClick:t=>{return e=a.id,void v({url:`/pages/detail-activity/detail-activity?id=${e}`});var e}},{default:e((()=>[i(q,{class:"card-left"},{default:e((()=>[i(q,{class:n(["date-box","status-"+a.statusType])},{default:e((()=>[i(F,{class:"month"},{default:e((()=>[c(f(a.month),1)])),_:2},1024),i(F,{class:"day"},{default:e((()=>[c(f(a.day),1)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1024),i(q,{class:"card-right"},{default:e((()=>[i(q,{class:"info"},{default:e((()=>[i(F,{class:"act-title"},{default:e((()=>[c(f(a.title),1)])),_:2},1024),i(q,{class:"tag-row"},{default:e((()=>[a.isJoined?(l(),t(F,{key:0,class:"joined-tag"},{default:e((()=>[c("å·²æŠ¥å")])),_:1})):r("",!0),i(F,{class:"act-time"},{default:e((()=>[c("ðŸ•’ "+f(a.time),1)])),_:2},1024)])),_:2},1024),i(F,{class:"act-loc"},{default:e((()=>[c("ðŸ“ "+f(a.location),1)])),_:2},1024),a.joinedPeople>0?(l(),t(F,{key:0,class:"act-people"},{default:e((()=>[c("ðŸ‘¥ "+f(a.joinedPeople)+"/"+f(a.maxPeople)+" å·²æŠ¥å",1)])),_:2},1024)):r("",!0)])),_:2},1024),i(q,{class:n(["status-badge",["badge-"+a.statusType,{clickable:D(a)}]]),onClick:g((t=>(async a=>{if(!D(a))return;if(_("token"))try{y({title:"æŠ¥åä¸­..."});const t=await x({url:`/activity/join?id=${a.id}`,method:"POST"});b(),200===t.code?(k({title:"æŠ¥åæˆåŠŸ",icon:"success"}),S()):k({title:t.msg||"æŠ¥åå¤±è´¥",icon:"none"})}catch(t){b(),k({title:"ç½‘ç»œé”™è¯¯",icon:"none"})}else v({url:"/pages/login/login"})})(a)),["stop"])},{default:e((()=>[c(f(a.statusText),1)])),_:2},1032,["class","onClick"])])),_:2},1024)])),_:2},1032,["onClick"])))),128)),0===C.value.length?(l(),t(q,{key:0,class:"empty-tip"},{default:e((()=>[i(P,{src:h,mode:"aspectFit",class:"empty-img"}),i(F,null,{default:e((()=>[c("æš‚æ— ç›¸å…³æ´»åŠ¨")])),_:1})])),_:1})):r("",!0)])),_:1})])),_:1})}}},[["__scopeId","data-v-696c8c25"]]);export{w as default};
