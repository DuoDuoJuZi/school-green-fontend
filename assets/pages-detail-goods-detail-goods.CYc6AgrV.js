import{r as a,l as s,c as e,w as l,k as t,i as u,o as c,a as o,b as n,t as i,m as d,v as r,q as f,u as _,y as m,B as p,d as v,e as g}from"./index-CuaaJPDA.js";import{a as h,o as k}from"./uni-app.es.l4NMnEKD.js";import{r as y}from"./request.CEomxEkn.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=x({__name:"detail-goods",setup(x){const I=a(null),b=a(null);h((a=>{if(a.goods)try{I.value=JSON.parse(decodeURIComponent(a.goods)),I.value.desc||(I.value.desc="该商品为校园绿动专属定制礼品，采用环保材料制作，旨在鼓励大家践行绿色生活方式。库存有限，先到先得。"),I.value.stock||(I.value.stock=99)}catch(s){}})),k((()=>{j()}));const j=async()=>{if(s("token"))try{const a=await y({url:"/user/profile",hideErrorToast:!0});b.value=a.data.points}catch(a){b.value=null}},w=()=>{if(!s("token"))return d({url:"/pages/login/login"});r({title:"确认兑换",content:`确定消耗 ${I.value.price} 积分兑换 ${I.value.name} 吗？`,success:a=>{a.confirm&&(f({title:"兑换中..."}),y({url:"/mall/exchange",method:"POST",data:{goodsId:I.value.id,cost:I.value.price,title:I.value.name}}).then((a=>{_(),b.value=a.data.remainingPoints;const e=s("userInfo");e&&(e.points=a.data.remainingPoints,m("userInfo",e)),p({title:"兑换成功！",icon:"success"})})).catch((()=>{_()})))}})};return(a,s)=>{const d=v,r=g,f=u;return I.value?(c(),e(f,{key:0,class:"page"},{default:l((()=>[o(d,{src:I.value.img,class:"goods-img",mode:"aspectFill"},null,8,["src"]),o(f,{class:"container"},{default:l((()=>[o(f,{class:"header"},{default:l((()=>[o(f,{class:"price-row"},{default:l((()=>[o(r,{class:"price"},{default:l((()=>[n(i(I.value.price),1)])),_:1}),o(r,{class:"unit"},{default:l((()=>[n("积分")])),_:1})])),_:1}),o(r,{class:"title"},{default:l((()=>[n(i(I.value.name),1)])),_:1}),o(f,{class:"stock"},{default:l((()=>[n("库存: "+i(I.value.stock)+" 件",1)])),_:1})])),_:1}),o(f,{class:"section"},{default:l((()=>[o(r,{class:"section-title"},{default:l((()=>[n("商品详情")])),_:1}),o(f,{class:"desc-content"},{default:l((()=>[o(r,null,{default:l((()=>[n(i(I.value.desc),1)])),_:1})])),_:1})])),_:1}),o(f,{class:"section"},{default:l((()=>[o(r,{class:"section-title"},{default:l((()=>[n("兑换须知")])),_:1}),o(f,{class:"rules-list"},{default:l((()=>[o(f,{class:"rule-item"},{default:l((()=>[n("• 兑换成功后请凭兑换码到大学生活动中心领取。")])),_:1}),o(f,{class:"rule-item"},{default:l((()=>[n("• 积分一经扣除，非质量问题不予退还。")])),_:1}),o(f,{class:"rule-item"},{default:l((()=>[n("• 请在 7 个工作日内完成领取。")])),_:1})])),_:1})])),_:1})])),_:1}),o(f,{class:"bottom-bar"},{default:l((()=>[o(f,{class:"my-points"},{default:l((()=>[o(r,null,{default:l((()=>[n("我的积分: ")])),_:1}),o(r,{class:"points-val"},{default:l((()=>[n(i(null!==b.value?b.value:"--"),1)])),_:1})])),_:1}),o(f,{class:"exchange-btn",onClick:w},{default:l((()=>[n("立即兑换")])),_:1})])),_:1})])),_:1})):t("",!0)}}},[["__scopeId","data-v-16f3d0f9"]]);export{I as default};
