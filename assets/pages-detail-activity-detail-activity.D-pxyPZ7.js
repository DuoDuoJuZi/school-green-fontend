import{r as a,B as e,f as t,c as s,w as l,k as u,i,o as n,a as c,b as o,t as d,n as r,l as f,m as v,q as _,u as p,d as g,e as m}from"./index-CuaaJPDA.js";import{a as $}from"./uni-app.es.l4NMnEKD.js";import{r as b}from"./request.CEomxEkn.js";import{_ as h}from"./_plugin-vue_export-helper.BCo6x5W8.js";const y=h({__name:"detail-activity",setup(h){const y=a(null);$((a=>{const e=a.id;e&&S(e)}));const S=async a=>{try{const e=await b({url:`/activity/detail?id=${a}`});e.data&&(y.value=e.data)}catch(t){e({title:"加载失败",icon:"none"})}},j=t((()=>!!y.value&&(!y.value.isJoined&&("ended"!==y.value.status&&!(y.value.joinedPeople>=y.value.maxPeople))))),k=t((()=>y.value?y.value.isJoined?"已报名":"ended"===y.value.status?"活动已结束":y.value.joinedPeople>=y.value.maxPeople?"名额已满":(y.value.status,"立即报名"):"加载中...")),P=async()=>{if(!j.value)return;if(f("token"))try{_({title:"提交中..."});const a=await b({url:`/activity/join?id=${y.value.id}`,method:"POST"});p(),200===a.code?(e({title:"报名成功",icon:"success"}),S(y.value.id)):e({title:a.msg||"报名失败",icon:"none"})}catch(a){p(),e({title:"网络错误",icon:"none"})}else v({url:"/pages/login/login"})},w=(a,e)=>{if(!a||!e)return"";const t=new Date(a),s=new Date(e);return`${`${t.getFullYear()}年${t.getMonth()+1}月${t.getDate()}日`} ${`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}-${`${s.getHours().toString().padStart(2,"0")}:${s.getMinutes().toString().padStart(2,"0")}`}`};return(a,e)=>{const t=g,f=m,v=i;return y.value?(n(),s(v,{key:0,class:"page"},{default:l((()=>{return[c(t,{src:(a=y.value.img,a?a.startsWith("http")?a:"https://kkbaemygbrzk.ap-northeast-1.clawcloudrun.com"+a:""),mode:"aspectFill",class:"poster"},null,8,["src"]),c(v,{class:"container"},{default:l((()=>[c(v,{class:"header"},{default:l((()=>[c(f,{class:"title"},{default:l((()=>[o(d(y.value.title),1)])),_:1}),c(v,{class:"tags"},{default:l((()=>[c(f,{class:"tag"},{default:l((()=>[o("线下活动")])),_:1}),c(f,{class:"tag"},{default:l((()=>[o("积分奖励")])),_:1}),y.value.status?(n(),s(f,{key:0,class:"tag"},{default:l((()=>{return[o(d((a=y.value.status,{ongoing:"进行中",upcoming:"即将开始",ended:"已结束"}[a]||a)),1)];var a})),_:1})):u("",!0)])),_:1})])),_:1}),c(v,{class:"info-list"},{default:l((()=>[c(v,{class:"info-item"},{default:l((()=>[c(f,{class:"label"},{default:l((()=>[o("时间")])),_:1}),c(f,{class:"value"},{default:l((()=>[o(d(w(y.value.startTime,y.value.endTime)),1)])),_:1})])),_:1}),c(v,{class:"info-item"},{default:l((()=>[c(f,{class:"label"},{default:l((()=>[o("地点")])),_:1}),c(f,{class:"value"},{default:l((()=>[o(d(y.value.location),1)])),_:1})])),_:1}),c(v,{class:"info-item"},{default:l((()=>[c(f,{class:"label"},{default:l((()=>[o("人数")])),_:1}),c(f,{class:"value"},{default:l((()=>[o("已报名 "+d(y.value.joinedPeople)+" / 限 "+d(y.value.maxPeople)+" 人",1)])),_:1})])),_:1})])),_:1}),c(v,{class:"section"},{default:l((()=>[c(f,{class:"section-title"},{default:l((()=>[o("活动详情")])),_:1}),c(f,{class:"desc"},{default:l((()=>[o(d(y.value.desc),1)])),_:1})])),_:1}),c(v,{class:"section"},{default:l((()=>[c(f,{class:"section-title"},{default:l((()=>[o("参与规则")])),_:1}),c(v,{class:"rules"},{default:l((()=>[c(v,{class:"rule"},{default:l((()=>[o("1. 点击下方按钮报名参加。")])),_:1}),c(v,{class:"rule"},{default:l((()=>[o("2. 活动当天到达现场签到。")])),_:1}),c(v,{class:"rule"},{default:l((()=>[o("3. 完成任务后凭记录领取 50 环保积分。")])),_:1})])),_:1})])),_:1})])),_:1}),c(v,{class:"bottom-bar"},{default:l((()=>[c(v,{class:r(["btn",{disabled:!j.value}]),onClick:P},{default:l((()=>[o(d(k.value),1)])),_:1},8,["class"])])),_:1})];var a})),_:1})):u("",!0)}}},[["__scopeId","data-v-65ee31eb"]]);export{y as default};
