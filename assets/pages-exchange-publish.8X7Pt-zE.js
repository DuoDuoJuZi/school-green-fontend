import{r as e,c as l,w as a,i as s,o as t,a as u,b as o,h as c,j as n,F as i,n as d,k as r,t as p,D as f,B as v,l as m,E as _,G as g,d as b,e as h,I as k,J as y,H as V}from"./index-CuaaJPDA.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";const C=x({__name:"publish",setup(x){const C=["图书","数码","乐器","运动","生活","其他"],U=e("图书"),j=e("points"),w=e(""),z=e(""),F=e(""),I=e(""),B=e(""),D=e(!1),J=()=>{f({count:1,sizeType:["compressed"],success:e=>{B.value=e.tempFilePaths[0]}})},P=()=>{if(!B.value)return v({title:"请上传图片",icon:"none"});if(!w.value)return v({title:"请输入名称",icon:"none"});if(!z.value)return v({title:"请输入描述",icon:"none"});if("points"===j.value&&!F.value)return v({title:"请输入积分",icon:"none"});if("goods"===j.value&&!I.value)return v({title:"请输入想换物品",icon:"none"});const e=m("token");e?(D.value=!0,_({url:"https://kkbaemygbrzk.ap-northeast-1.clawcloudrun.com/v1/exchange/publish",filePath:B.value,name:"file",header:{Authorization:`Bearer ${e}`},formData:{title:w.value,desc:z.value,category:U.value,price:F.value||0,exchangeMode:j.value,targetItem:I.value},success:e=>{D.value=!1;try{const l=JSON.parse(e.data);200===l.code?(v({title:"发布成功",icon:"success"}),setTimeout((()=>{g()}),1500)):v({title:l.msg||"发布失败",icon:"none"})}catch(l){v({title:"解析失败",icon:"none"})}},fail:()=>{D.value=!1,v({title:"网络错误",icon:"none"})}})):v({title:"请先登录",icon:"none"})};return(e,f)=>{const v=b,m=h,_=s,g=k,x=y,T=V;return t(),l(_,{class:"publish-page"},{default:a((()=>[u(_,{class:"form-group"},{default:a((()=>[u(_,{class:"image-picker",onClick:J},{default:a((()=>[B.value?(t(),l(v,{key:0,src:B.value,mode:"aspectFill",class:"preview-img"},null,8,["src"])):(t(),l(_,{key:1,class:"placeholder"},{default:a((()=>[u(m,{class:"plus"},{default:a((()=>[o("+")])),_:1}),u(m,{class:"tip"},{default:a((()=>[o("添加物品图片")])),_:1})])),_:1}))])),_:1})])),_:1}),u(_,{class:"form-group"},{default:a((()=>[u(m,{class:"label"},{default:a((()=>[o("物品名称")])),_:1}),u(g,{class:"input",type:"text",modelValue:w.value,"onUpdate:modelValue":f[0]||(f[0]=e=>w.value=e),placeholder:"品牌 型号 关键信息"},null,8,["modelValue"])])),_:1}),u(_,{class:"form-group"},{default:a((()=>[u(m,{class:"label"},{default:a((()=>[o("描述")])),_:1}),u(x,{class:"textarea",modelValue:z.value,"onUpdate:modelValue":f[1]||(f[1]=e=>z.value=e),placeholder:"描述物品的新旧程度、入手渠道、转手原因等..."},null,8,["modelValue"])])),_:1}),u(_,{class:"form-group"},{default:a((()=>[u(m,{class:"label"},{default:a((()=>[o("分类")])),_:1}),u(_,{class:"tags-container"},{default:a((()=>[(t(),c(i,null,n(C,((e,l)=>u(_,{class:d(["tag-item",{active:U.value===e}]),key:l,onClick:l=>U.value=e},{default:a((()=>[o(p(e),1)])),_:2},1032,["class","onClick"]))),64))])),_:1})])),_:1}),u(_,{class:"form-group"},{default:a((()=>[u(m,{class:"label"},{default:a((()=>[o("交易方式")])),_:1}),u(_,{class:"radio-group"},{default:a((()=>[u(_,{class:d(["radio-item",{active:"points"===j.value}]),onClick:f[2]||(f[2]=e=>j.value="points")},{default:a((()=>[u(m,null,{default:a((()=>[o("环保积分")])),_:1})])),_:1},8,["class"]),u(_,{class:d(["radio-item",{active:"goods"===j.value}]),onClick:f[3]||(f[3]=e=>j.value="goods")},{default:a((()=>[u(m,null,{default:a((()=>[o("以物易物")])),_:1})])),_:1},8,["class"])])),_:1})])),_:1}),"points"===j.value?(t(),l(_,{key:0,class:"form-group"},{default:a((()=>[u(m,{class:"label"},{default:a((()=>[o("所需积分")])),_:1}),u(g,{class:"input",type:"number",modelValue:F.value,"onUpdate:modelValue":f[4]||(f[4]=e=>F.value=e),placeholder:"0"},null,8,["modelValue"])])),_:1})):r("",!0),"goods"===j.value?(t(),l(_,{key:1,class:"form-group"},{default:a((()=>[u(m,{class:"label"},{default:a((()=>[o("想换什么")])),_:1}),u(g,{class:"input",type:"text",modelValue:I.value,"onUpdate:modelValue":f[5]||(f[5]=e=>I.value=e),placeholder:"例如：台灯、书架..."},null,8,["modelValue"])])),_:1})):r("",!0),u(T,{class:"submit-btn",onClick:P,disabled:D.value},{default:a((()=>[o(p(D.value?"发布中...":"发布闲置"),1)])),_:1},8,["disabled"])])),_:1})}}},[["__scopeId","data-v-9b924be6"]]);export{C as default};
