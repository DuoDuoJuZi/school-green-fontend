import{r as e,c as a,w as l,i as s,o as t,a as o,b as u,h as c,j as i,F as n,t as r,D as d,B as p,l as f,m,E as v,G as _,d as g,e as k,I as h,H as b,n as y}from"./index-CuaaJPDA.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";const C=x({__name:"upload",setup(x){const C=["校园风光","微观生态","绿色生活","动植物","天空"],j=e("校园风光"),w=e(""),z=e(""),F=e(!1),T=()=>{d({count:1,sizeType:["compressed"],success:e=>{z.value=e.tempFilePaths[0]}})},V=()=>{if(!z.value)return void p({title:"请先选择图片",icon:"none"});if(!w.value)return void p({title:"请输入标题",icon:"none"});const e=f("token");if(!e)return p({title:"请先登录",icon:"none"}),void setTimeout((()=>{m({url:"/pages/login/login"})}),1500);F.value=!0,v({url:"https://kkbaemygbrzk.ap-northeast-1.clawcloudrun.com/v1/gallery/upload",filePath:z.value,name:"file",header:{Authorization:`Bearer ${e}`},formData:{title:w.value,category:j.value},success:e=>{F.value=!1;try{const a=JSON.parse(e.data);200===a.code?(p({title:"发布成功",icon:"success"}),setTimeout((()=>{_()}),1500)):p({title:a.msg||"发布失败",icon:"none"})}catch(a){p({title:"解析响应失败",icon:"none"})}},fail:()=>{F.value=!1,p({title:"网络请求失败",icon:"none"})}})};return(e,d)=>{const p=g,f=k,m=s,v=h,_=b;return t(),a(m,{class:"upload-page"},{default:l((()=>[o(m,{class:"form-group"},{default:l((()=>[o(m,{class:"image-picker",onClick:T},{default:l((()=>[z.value?(t(),a(p,{key:0,src:z.value,mode:"aspectFill",class:"preview-img"},null,8,["src"])):(t(),a(m,{key:1,class:"placeholder"},{default:l((()=>[o(f,{class:"plus"},{default:l((()=>[u("+")])),_:1}),o(f,{class:"tip"},{default:l((()=>[u("点击上传图片")])),_:1})])),_:1}))])),_:1})])),_:1}),o(m,{class:"form-group"},{default:l((()=>[o(f,{class:"label"},{default:l((()=>[u("标题 / 描述")])),_:1}),o(v,{class:"input",type:"text",modelValue:w.value,"onUpdate:modelValue":d[0]||(d[0]=e=>w.value=e),placeholder:"给这张照片起个名字吧..."},null,8,["modelValue"])])),_:1}),o(m,{class:"form-group"},{default:l((()=>[o(f,{class:"label"},{default:l((()=>[u("选择标签")])),_:1}),o(m,{class:"tags-container"},{default:l((()=>[(t(),c(n,null,i(C,((e,a)=>o(m,{class:y(["tag-item",{active:j.value===e}]),key:a,onClick:a=>j.value=e},{default:l((()=>[u(r(e),1)])),_:2},1032,["class","onClick"]))),64))])),_:1})])),_:1}),o(_,{class:"submit-btn",onClick:V,disabled:F.value},{default:l((()=>[u(r(F.value?"发布中...":"发布瞬间"),1)])),_:1},8,["disabled"])])),_:1})}}},[["__scopeId","data-v-0a00c371"]]);export{C as default};
