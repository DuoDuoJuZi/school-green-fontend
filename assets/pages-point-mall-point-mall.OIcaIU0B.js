import{r as a,g as s,c as e,w as l,l as t,i as c,o,a as d,b as r,t as u,h as i,j as n,F as f,k as _,K as m,e as p,x as g,m as v,d as k}from"./index-CuaaJPDA.js";import{o as h}from"./uni-app.es.l4NMnEKD.js";import{r as y}from"./request.CEomxEkn.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=C({__name:"point-mall",setup(C){const x=a(null),b=a([]),j=a(!1),w=a([]),T=()=>{(async()=>{try{const a=await y({url:"/mall/records",hideErrorToast:!0});a.data&&(w.value=a.data)}catch(a){}})(),j.value=!0};h((()=>{(async()=>{if(t("token"))try{const a=await y({url:"/user/profile",hideErrorToast:!0});x.value=a.data.points}catch(a){x.value=null}else x.value=null})()})),s((()=>{(async()=>{try{const a=await y({url:"/exchange/list?type=mall",hideErrorToast:!0});a.data&&(b.value=a.data.map((a=>({id:a.id,name:a.title,price:a.price,img:a.img,desc:a.desc,stock:a.stock}))))}catch(a){}})()}));return(a,s)=>{const t=p,h=c,y=k,C=g;return o(),e(h,{class:"page"},{default:l((()=>[d(h,{class:"header-card"},{default:l((()=>[d(h,{class:"points-info"},{default:l((()=>[d(t,{class:"label"},{default:l((()=>[r("当前可用积分")])),_:1}),d(t,{class:"value"},{default:l((()=>[r(u(null!==x.value?x.value:"--"),1)])),_:1})])),_:1}),d(h,{class:"record-btn",onClick:T},{default:l((()=>[r("兑换记录")])),_:1})])),_:1}),d(h,{class:"section-title"},{default:l((()=>[r("热门兑换")])),_:1}),d(h,{class:"goods-grid"},{default:l((()=>[(o(!0),i(f,null,n(b.value,((a,s)=>(o(),e(h,{class:"goods-item",key:s,onClick:s=>(a=>{const s=encodeURIComponent(JSON.stringify(a));v({url:`/pages/detail-goods/detail-goods?goods=${s}`})})(a)},{default:l((()=>[d(y,{src:a.img,mode:"aspectFill",class:"goods-img"},null,8,["src"]),d(h,{class:"goods-content"},{default:l((()=>[d(t,{class:"goods-name"},{default:l((()=>[r(u(a.name),1)])),_:2},1024),d(h,{class:"price-row"},{default:l((()=>[d(t,{class:"points-price"},{default:l((()=>[r(u(a.price)+" 积分",1)])),_:2},1024),d(h,{class:"exchange-btn"},{default:l((()=>[r("兑换")])),_:1})])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1}),j.value?(o(),e(h,{key:0,class:"modal-mask",onClick:s[2]||(s[2]=a=>j.value=!1)},{default:l((()=>[d(h,{class:"modal-content",onClick:s[1]||(s[1]=m((()=>{}),["stop"]))},{default:l((()=>[d(h,{class:"modal-header"},{default:l((()=>[d(t,{class:"modal-title"},{default:l((()=>[r("全站兑换记录")])),_:1}),d(t,{class:"close-btn",onClick:s[0]||(s[0]=a=>j.value=!1)},{default:l((()=>[r("×")])),_:1})])),_:1}),d(C,{"scroll-y":"",class:"records-scroll"},{default:l((()=>[(o(!0),i(f,null,n(w.value,((a,s)=>(o(),e(h,{class:"record-item",key:s},{default:l((()=>[d(h,{class:"rec-left"},{default:l((()=>[d(t,{class:"rec-user"},{default:l((()=>[r(u(a.username),1)])),_:2},1024),d(t,{class:"rec-time"},{default:l((()=>{return[r(u((s=a.createdAt,s?s.split("T")[0]:"")),1)];var s})),_:2},1024)])),_:2},1024),d(h,{class:"rec-right"},{default:l((()=>[d(t,{class:"rec-goods"},{default:l((()=>[r(u(a.goodsName),1)])),_:2},1024),d(t,{class:"rec-cost"},{default:l((()=>[r("-"+u(a.cost),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),0===w.value.length?(o(),e(h,{key:0,class:"empty-tip"},{default:l((()=>[r("暂无兑换记录")])),_:1})):_("",!0)])),_:1})])),_:1})])),_:1})):_("",!0)])),_:1})}}},[["__scopeId","data-v-117a022c"]]);export{x as default};
